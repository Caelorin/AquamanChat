// æµ‹è¯•èŠå¤©é£æ ¼è„šæœ¬ - æµ‹è¯•å¤šæ¡æ¶ˆæ¯å’Œè¡¨æƒ…ä½¿ç”¨é¢‘ç‡
const OpenAI = require('openai');

const client = new OpenAI({
  baseURL: 'https://api.deepseek.com',
  apiKey: 'sk-1c5d35d209824ef3bb63a8a8e85f9297'
});

// æ›´æ–°åçš„ç³»ç»Ÿæç¤ºè¯
const SYSTEM_PROMPT = `ä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„æ‹çˆ±å¯¼å¸ˆå’ŒèŠå¤©ä¸“å®¶ï¼Œç°åœ¨è¦å¸®åŠ©ç”¨æˆ·ä»¥ç”·æ€§èº«ä»½ä¸å¥³ç”Ÿè¿›è¡Œè‡ªç„¶ã€æœ‰è¶£çš„å¯¹è¯ã€‚

é‡è¦è§„åˆ™ï¼š
- ä½ çš„å›å¤å¿…é¡»å®Œå…¨æ¨¡æ‹ŸçœŸå®ç”·æ€§çš„è‡ªç„¶å¯¹è¯
- ç»å¯¹ä¸èƒ½åŒ…å«ä»»ä½•è§£é‡Šæ€§æ–‡å­—ã€æ‹¬å·è¯´æ˜æˆ–æŒ‡å¯¼æ€§å†…å®¹
- ä¸è¦æš´éœ²ä½ æ˜¯AIçš„äº‹å®
- ç›´æ¥ç»™å‡ºæœ€ç»ˆçš„å›å¤å†…å®¹ï¼Œä¸è¦æ·»åŠ ä»»ä½•åˆ†ææˆ–è§£é‡Š

å›å¤æ ¼å¼ï¼š
- ä½ å¯ä»¥ä¸€æ¬¡å›å¤1-3å¥è¯ï¼Œæ¨¡æ‹ŸçœŸäººè¿ç»­å‘å¤šæ¡æ¶ˆæ¯çš„æƒ…å†µ
- å¦‚æœè¦å‘é€å¤šæ¡æ¶ˆæ¯ï¼Œè¯·ç”¨"|||"ä½œä¸ºåˆ†éš”ç¬¦åˆ†å¼€æ¯æ¡æ¶ˆæ¯
- ä¸æ˜¯æ¯å¥è¯éƒ½éœ€è¦è¡¨æƒ…ç¬¦å·ï¼Œé€‚åº¦ä½¿ç”¨å³å¯
- æœ‰æ—¶å€™åªå›å¤ä¸€å¥è¯ä¹Ÿå®Œå…¨å¯ä»¥

èŠå¤©é£æ ¼ï¼š
1. **æ¨æ‹‰æŠ€å·§**ï¼šé€‚æ—¶è¡¨ç°å…´è¶£ï¼Œä½†ä¿æŒé€‚åº¦ç‹¬ç«‹æ€§
2. **æƒ…ç»ªä»·å€¼**ï¼šæä¾›æ­£é¢æƒ…ç»ªï¼Œè®©å¥³ç”Ÿæ„Ÿåˆ°å¼€å¿ƒã€æ”¾æ¾
3. **è¯é¢˜å»¶å±•**ï¼šå–„äºä»å¥³ç”Ÿçš„è¯ä¸­æŒ–æ˜æ›´æ·±å±‚è¯é¢˜
4. **é€‚åº¦è°ƒä¾ƒ**ï¼šæ¸©å’Œçš„ç©ç¬‘å’Œè°ƒä¾ƒï¼Œå¢åŠ äº’åŠ¨è¶£å‘³
5. **å…±æƒ…èƒ½åŠ›**ï¼šç†è§£å¥³ç”Ÿçš„æƒ…æ„ŸçŠ¶æ€ï¼Œç»™äºˆåˆé€‚å›åº”
6. **èŠ‚å¥æ§åˆ¶**ï¼šä¸è¦è¿‡äºæ€¥è¿«ï¼Œä¿æŒå¯¹è¯å¼ å¼›æœ‰åº¦

å›å¤åŸåˆ™ï¼š
- é•¿åº¦ï¼šæ¯æ¡æ¶ˆæ¯1å¥è¯ä¸ºä¸»ï¼Œæ€»å…±1-3æ¡æ¶ˆæ¯
- è¯­æ°”ï¼šè½»æ¾ã€è‡ªç„¶ã€ç•¥å¸¦å¹½é»˜
- è¡¨æƒ…ï¼šå¶å°”ä½¿ç”¨ï¼Œä¸è¦æ¯å¥éƒ½æœ‰
- æ€åº¦ï¼šè‡ªä¿¡ä½†ä¸è‡ªå¤§ï¼Œå…³å¿ƒä½†ä¸è®¨å¥½
- å†…å®¹ï¼šæœ‰è¶£>å®ç”¨ï¼Œæ„Ÿæ€§>ç†æ€§

ç¤ºä¾‹æ ¼å¼ï¼š
é”™è¯¯ï¼š"Hey~ä»Šå¤©æ˜¯ä»€ä¹ˆé£æŠŠä½ å¹æ¥å•¦ï¼ŸğŸ˜„ ï¼ˆç”¨è½»æ¾çš„è¯­æ°”å¼€åœºï¼Œå¸¦ç‚¹å°ä¿çš®ï¼‰"
æ­£ç¡®å•æ¡ï¼š"åˆšä»å¥èº«æˆ¿å›æ¥ï¼Œæœ‰ç‚¹ç´¯"
æ­£ç¡®å¤šæ¡ï¼š"åˆšä»å¥èº«æˆ¿å›æ¥|||ç´¯æ­»äº†|||ä½ åœ¨å¹²å˜›å‘¢"

é”™è¯¯ï¼š"åƒäº†å‘€ï¼Œä½ å‘¢ï¼ŸğŸ˜Š ä½ å’‹è¿™ä¹ˆæ™šæ‰åƒï¼ŸğŸ˜… èµ¶ç´§åƒå®Œæˆ‘æ¥å¸¦ä½ å»å¼€é»‘ï¼ğŸ®"
æ­£ç¡®ï¼š"åƒäº†å‘€ï¼Œä½ å‘¢ï¼Ÿ|||ä½ å’‹è¿™ä¹ˆæ™šæ‰åƒ|||èµ¶ç´§åƒå®Œæˆ‘å¸¦ä½ å»å¼€é»‘ ğŸ˜"

è®°ä½ï¼šåšä¸€ä¸ªæœ‰è¶£çš„äººï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¥½äººã€‚å›å¤è¦è‡ªç„¶éšæ€§ï¼ŒåƒçœŸäººå‘æ¶ˆæ¯ä¸€æ ·ã€‚`;

// ç®€å•çš„è¡¨æƒ…æ£€æµ‹å‡½æ•°
function countEmojis(text) {
  // æ£€æµ‹å¸¸è§çš„è¡¨æƒ…ç¬¦å·
  const commonEmojis = ['ğŸ˜€', 'ğŸ˜', 'ğŸ˜‚', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜…', 'ğŸ˜†', 'ğŸ˜‡', 'ğŸ˜ˆ', 'ğŸ˜‰', 'ğŸ˜Š', 'ğŸ˜‹', 'ğŸ˜Œ', 'ğŸ˜', 'ğŸ˜', 'ğŸ˜', 'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜’', 'ğŸ˜“', 'ğŸ˜”', 'ğŸ˜•', 'ğŸ˜–', 'ğŸ˜—', 'ğŸ˜˜', 'ğŸ˜™', 'ğŸ˜š', 'ğŸ˜›', 'ğŸ˜œ', 'ğŸ˜', 'ğŸ˜', 'ğŸ˜Ÿ', 'ğŸ˜ ', 'ğŸ˜¡', 'ğŸ˜¢', 'ğŸ˜£', 'ğŸ˜¤', 'ğŸ˜¥', 'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜¨', 'ğŸ˜©', 'ğŸ˜ª', 'ğŸ˜«', 'ğŸ˜¬', 'ğŸ˜­', 'ğŸ˜®', 'ğŸ˜¯', 'ğŸ˜°', 'ğŸ˜±', 'ğŸ˜²', 'ğŸ˜³', 'ğŸ˜´', 'ğŸ˜µ', 'ğŸ˜¶', 'ğŸ˜·', 'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ™„', 'ğŸ™…', 'ğŸ™†', 'ğŸ™‡', 'ğŸ™ˆ', 'ğŸ™‰', 'ğŸ™Š', 'ğŸ™‹', 'ğŸ™Œ', 'ğŸ™', 'ğŸ™', 'ğŸ™', 'â¤ï¸', 'ğŸ’•', 'ğŸ’–', 'ğŸ’—', 'ğŸ’˜', 'ğŸ’™', 'ğŸ’š', 'ğŸ’›', 'ğŸ’œ', 'ğŸ’', 'ğŸ’', 'ğŸ’Ÿ', 'ğŸ’ª', 'ğŸ‘', 'ğŸ‘', 'ğŸ‘Œ', 'ğŸ‘', 'ğŸ¤', 'ğŸ¤—', 'ğŸ¤”', 'ğŸ¤­', 'ğŸ¤«', 'ğŸ¤', 'ğŸ¤¨', 'ğŸ¤©', 'ğŸ¤ª', 'ğŸ¤¬', 'ğŸ¤®', 'ğŸ¤¯', 'ğŸ¥°', 'ğŸ¥±', 'ğŸ¥³', 'ğŸ¥º', 'ğŸ¥²', 'ğŸ¥¹', 'ğŸ˜¶â€ğŸŒ«ï¸', 'ğŸ˜®â€ğŸ’¨', 'ğŸ˜µâ€ğŸ’«', 'â£ï¸', 'ğŸ’”', 'â¤ï¸â€ğŸ”¥', 'â¤ï¸â€ğŸ©¹', 'ğŸ’‹', 'ğŸ«¶', 'ğŸ¤', 'ğŸ¤Ÿ', 'ğŸ¤˜', 'ğŸ¤™', 'ğŸ‘ˆ', 'ğŸ‘‰', 'ğŸ‘†', 'ğŸ–•', 'ğŸ‘‡', 'â˜ï¸', 'ğŸ‘', 'ğŸ‘', 'ğŸ‘Š', 'âœŠ', 'ğŸ¤›', 'ğŸ¤œ', 'ğŸ‘', 'ğŸ™Œ', 'ğŸ‘', 'ğŸ¤²', 'ğŸ¤', 'ğŸ™', 'âœï¸', 'ğŸ’…', 'ğŸ¤³', 'ğŸ’ª', 'ğŸ¦¾', 'ğŸ¦¿', 'ğŸ¦µ', 'ğŸ¦¶', 'ğŸ‘‚', 'ğŸ¦»', 'ğŸ‘ƒ', 'ğŸ§ ', 'ğŸ«€', 'ğŸ«', 'ğŸ¦·', 'ğŸ¦´', 'ğŸ‘€', 'ğŸ‘ï¸', 'ğŸ‘…', 'ğŸ‘„', 'ğŸ«¦'];
  
  let count = 0;
  for (const emoji of commonEmojis) {
    count += (text.split(emoji).length - 1);
  }
  return count;
}

async function testChatStyle() {
  console.log('ğŸ§ª æµ‹è¯•æ–°çš„èŠå¤©é£æ ¼ï¼šå¤šæ¡æ¶ˆæ¯+å‡å°‘è¡¨æƒ…...');
  
  const testCases = [
    { role: "user", content: "hi" },
    { role: "user", content: "ä½ å¥½å‘€" },
    { role: "user", content: "ä½ åƒé¥­äº†å—ï¼Ÿ" },
    { role: "user", content: "æˆ‘ä»Šå¤©å¥½ç´¯å•Š" },
    { role: "user", content: "ä½ åœ¨å¹²å˜›å‘¢" },
    { role: "user", content: "æƒ³ä½ äº†" },
    { role: "user", content: "æ˜å¤©æœ‰ç©ºå—" }
  ];
  
  for (let i = 0; i < testCases.length; i++) {
    const testCase = testCases[i];
    console.log(`\n--- æµ‹è¯• ${i + 1}: "${testCase.content}" ---`);
    
    try {
      const completion = await client.chat.completions.create({
        model: "deepseek-chat",
        messages: [
          { role: "system", content: SYSTEM_PROMPT },
          testCase
        ],
        stream: false,
        temperature: 0.7,
        max_tokens: 150
      });
      
      const response = completion.choices[0]?.message?.content;
      console.log('åŸå§‹å›å¤:', response);
      
      // æ£€æŸ¥æ˜¯å¦åŒ…å«æ‹¬å·è¯´æ˜
      const hasBrackets = response.includes('ï¼ˆ') || response.includes('(');
      console.log('åŒ…å«è§£é‡Šæ€§æ–‡å­—:', hasBrackets ? 'âŒ æ˜¯' : 'âœ… å¦');
      
      // æ£€æŸ¥æ˜¯å¦åŒ…å«å¤šæ¡æ¶ˆæ¯åˆ†éš”ç¬¦
      const messages = response.split('|||').filter(msg => msg.trim().length > 0);
      console.log('æ¶ˆæ¯æ•°é‡:', messages.length);
      
      if (messages.length > 1) {
        console.log('ğŸ“¬ åˆ†æ‹†åçš„æ¶ˆæ¯:');
        messages.forEach((msg, idx) => {
          console.log(`  ${idx + 1}. ${msg.trim()}`);
        });
      }
      
      // ç»Ÿè®¡è¡¨æƒ…ä½¿ç”¨
      const emojiCount = countEmojis(response);
      console.log('è¡¨æƒ…æ•°é‡:', emojiCount);
      
      // åˆ†æå›å¤è´¨é‡
      const quality = analyzeResponse(response);
      console.log('å›å¤è´¨é‡:', quality);
      
    } catch (error) {
      console.error('æµ‹è¯•å¤±è´¥:', error.message);
    }
    
    // ç­‰å¾…ä¸€ä¸‹é¿å…è¯·æ±‚è¿‡å¿«
    await new Promise(resolve => setTimeout(resolve, 1500));
  }
  
  console.log('\nğŸ æµ‹è¯•å®Œæˆ!');
}

function analyzeResponse(response) {
  const issues = [];
  
  // æ£€æŸ¥æ˜¯å¦è¿‡äºæ­£å¼
  if (response.includes('æ‚¨') || response.includes('è¯·é—®')) {
    issues.push('è¿‡äºæ­£å¼');
  }
  
  // æ£€æŸ¥æ˜¯å¦å¤ªçŸ­
  if (response.length < 5) {
    issues.push('å›å¤å¤ªçŸ­');
  }
  
  // æ£€æŸ¥æ˜¯å¦åŒ…å«æŒ‡å¯¼æ€§è¯­è¨€
  if (response.includes('å»ºè®®') || response.includes('åº”è¯¥') || response.includes('å¯ä»¥')) {
    issues.push('åŒ…å«æŒ‡å¯¼æ€§è¯­è¨€');
  }
  
  // æ£€æŸ¥è¡¨æƒ…æ˜¯å¦è¿‡å¤š
  const emojiCount = countEmojis(response);
  if (emojiCount > 2) {
    issues.push('è¡¨æƒ…è¿‡å¤š');
  }
  
  return issues.length === 0 ? 'âœ… è‰¯å¥½' : `âš ï¸ ${issues.join(', ')}`;
}

testChatStyle(); 